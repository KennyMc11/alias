<!-- templates/game/game.html -->
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò–≥—Ä–∞ Alias - –ö–æ–º–Ω–∞—Ç–∞ {{ room.room_id }}</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .room-id {
            font-size: 1.2em;
            color: #ffd700;
            margin: 10px 0;
        }

        .scores {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .score {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            min-width: 120px;
        }

        .score-a {
            background: rgba(255, 107, 107, 0.2);
            border: 2px solid #ff6b6b;
        }

        .score-b {
            background: rgba(77, 150, 255, 0.2);
            border: 2px solid #4d96ff;
        }

        .score-value {
            font-size: 2em;
            font-weight: bold;
            margin: 5px 0;
        }

        .target {
            font-size: 0.8em;
            opacity: 0.8;
        }

        .current-team {
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            font-size: 1.2em;
        }

        .players-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .player-role {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
        }

        .explainer {
            background: rgba(255, 107, 107, 0.2);
            border-left: 4px solid #ff6b6b;
        }

        .guesser {
            background: rgba(77, 150, 255, 0.2);
            border-left: 4px solid #4d96ff;
        }

        .word-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 40px 20px;
            margin: 30px 0;
            text-align: center;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .word {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            min-height: 1.2em;
        }

        .timer {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
            font-family: monospace;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-success {
            background: #51cf66;
            color: white;
        }

        .btn-primary {
            background: #4d96ff;
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-danger {
            background: #ff6b6b;
            color: white;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .message {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            display: none;
        }

        .error {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
        }

        .success {
            background: rgba(81, 207, 102, 0.2);
            color: #51cf66;
            border: 1px solid #51cf66;
        }

        .winner {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 2px solid #ffd700;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin: 30px 0;
            font-size: 1.5em;
            display: none;
        }

        .waiting {
            text-align: center;
            padding: 40px 20px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.2em;
        }

        .instructions {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
        }

        .back-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #4d96ff;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .pulse {
            animation: pulse 1s infinite;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ Alias</h1>
            <div class="room-id">–ö–æ–º–Ω–∞—Ç–∞: {{ room.room_id }}</div>
        </div>

        <div class="scores">
            <div class="score score-a">
                <div>–ö–æ–º–∞–Ω–¥–∞ A</div>
                <div class="score-value" id="scoreA">0</div>
                <div class="target">–¶–µ–ª—å: <span id="targetScore">25</span></div>
            </div>

            <div class="score score-b">
                <div>–ö–æ–º–∞–Ω–¥–∞ B</div>
                <div class="score-value" id="scoreB">0</div>
                <div class="target">–¶–µ–ª—å: <span id="targetScore">25</span></div>
            </div>
        </div>

        <div class="current-team" id="currentTeamInfo">
            –°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç: <span id="currentTeam">–ö–æ–º–∞–Ω–¥–∞ A</span>
        </div>

        <div class="players-info">
            <div class="player-role explainer">
                <span>–û–±—ä—è—Å–Ω—è–µ—Ç:</span>
                <span id="explainerName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="player-role guesser">
                <span>–£–≥–∞–¥—ã–≤–∞–µ—Ç:</span>
                <span id="guesserName">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
        </div>

        <div class="timer" id="timer">60</div>

        <div class="word-container" id="wordContainer">
            <div class="word" id="currentWord">
                <span id="wordText">–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ"</span>
            </div>
        </div>

        <div class="instructions" id="gameInstructions">
            <strong>üéØ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</strong><br>
            ‚Ä¢ –û–±—ä—è—Å–Ω—è—é—â–∏–π: –æ–±—ä—è—Å–Ω—è–π—Ç–µ —Å–ª–æ–≤–æ –±–µ–∑ –æ–¥–Ω–æ–∫–æ—Ä–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤<br>
            ‚Ä¢ –£–≥–∞–¥—ã–≤–∞—é—â–∏–π: —Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –ø–æ–Ω—è—Ç—å —Å–ª–æ–≤–æ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é<br>
            ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–í–µ—Ä–Ω–æ!" –µ—Å–ª–∏ —Å–ª–æ–≤–æ —É–≥–∞–¥–∞–Ω–æ (+1 –æ—á–∫–æ)<br>
            ‚Ä¢ –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å" –µ—Å–ª–∏ —Å–ª–æ–≤–æ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ
        </div>

        <div class="controls" id="gameControls">
            <button class="btn btn-success" onclick="wordGuessed()" id="guessedBtn">
                ‚úÖ –í–µ—Ä–Ω–æ!
            </button>
            <button class="btn btn-danger" onclick="skipWord()" id="skipBtn">
                ‚è≠Ô∏è –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å
            </button>
        </div>

        <button class="btn btn-warning" onclick="getNewWord()" id="newWordBtn">
            üîÑ –ù–æ–≤–æ–µ —Å–ª–æ–≤–æ
        </button>

        <button class="btn btn-secondary" onclick="nextTurn()" id="nextTurnBtn">
            ‚è≠Ô∏è –°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
        </button>

        <button class="btn btn-secondary" onclick="switchTeam()" id="switchTeamBtn">
            üîÑ –°–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
        </button>

        <a href="/room/{{ room.room_id }}/" class="back-btn">
            ‚Üê –ù–∞–∑–∞–¥ –≤ –∫–æ–º–Ω–∞—Ç—É
        </a>

        <div class="winner" id="winnerMessage">
            <h2>üéâ –ü–æ–±–µ–¥–∏–ª–∞ –∫–æ–º–∞–Ω–¥–∞ <span id="winnerTeam"></span>! üéâ</h2>
            <p style="margin-top: 15px;">–°—á–µ—Ç: <span id="finalScore"></span></p>
            <button class="btn btn-primary" onclick="location.reload()" style="margin-top: 20px;">
                üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞
            </button>
        </div>

        <div class="message error" id="errorMessage"></div>
        <div class="message success" id="successMessage"></div>
        <div id="room-data" data-room-id="{{ room.room_id }}" data-creator-id="{{ room_creator_id }}"
            style="display: none;">
        </div>
    </div>

        <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe?.user;
        let currentUser = null;
        
        if (user) {
            currentUser = {
                id: user.id,
                username: user.username || `User${user.id}`,
                firstName: user.first_name || '',
                lastName: user.last_name || ''
            };
        } else {
            // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            currentUser = {
                id: Math.floor(Math.random() * 1000000),
                username: 'TestUser'
            };
        }
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã –∏–∑ data-–∞—Ç—Ä–∏–±—É—Ç–æ–≤
        const roomDataElement = document.getElementById('room-data');
        const roomId = roomDataElement ? roomDataElement.dataset.roomId : '{{ room.room_id }}';
        const roomCreatorId = roomDataElement ? parseInt(roomDataElement.dataset.creatorId) : 0;
        
        let gameState = null;
        let timerInterval = null;
        let timeLeft = 60;
        let currentWord = null;
        let isExplainer = false;
        let isCreator = currentUser && (currentUser.id === roomCreatorId);
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
            setTimeout(() => errorEl.style.display = 'none', 5000);
        }
        
        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
            setTimeout(() => successEl.style.display = 'none', 3000);
        }
        
        // –¢–∞–π–º–µ—Ä
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 60;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showError('–í—Ä–µ–º—è –≤—ã—à–ª–æ!');
                    setTimeout(nextTurn, 2000);
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = timeLeft;
            
            // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –º–∞–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏
            if (timeLeft <= 10) {
                timerEl.style.color = '#ff6b6b';
                timerEl.classList.add('pulse');
            } else if (timeLeft <= 30) {
                timerEl.style.color = '#ffc107';
                timerEl.classList.remove('pulse');
            } else {
                timerEl.style.color = '#51cf66';
                timerEl.classList.remove('pulse');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        async function updateGameState() {
            try {
                const response = await fetch(`/api/game-state/${roomId}/`);
                const data = await response.json();
                
                if (data.success) {
                    gameState = data;
                    
                    // –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –Ω–∞—á–∞—Ç–∞
                    if (!data.is_game_started) {
                        document.getElementById('wordContainer').innerHTML = 
                            '<div class="waiting">–ò–≥—Ä–∞ –µ—â–µ –Ω–µ –Ω–∞—á–∞–ª–∞—Å—å. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫–æ–º–Ω–∞—Ç—É.</div>';
                        document.getElementById('gameControls').style.display = 'none';
                        document.getElementById('newWordBtn').style.display = 'none';
                        document.getElementById('nextTurnBtn').style.display = 'none';
                        document.getElementById('switchTeamBtn').style.display = 'none';
                        return;
                    }
                    
                    // –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
                    if (data.winner) {
                        showWinner(data.winner);
                        return;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
                    document.getElementById('scoreA').textContent = data.score_a;
                    document.getElementById('scoreB').textContent = data.score_b;
                    document.getElementById('targetScore').textContent = data.target_score;
                    
                    const currentTeam = data.current_team === 'A' ? '–ö–æ–º–∞–Ω–¥–∞ A' : '–ö–æ–º–∞–Ω–¥–∞ B';
                    document.getElementById('currentTeam').textContent = currentTeam;
                    
                    // –¶–≤–µ—Ç —Ç–µ–∫—É—â–µ–π –∫–æ–º–∞–Ω–¥—ã
                    if (data.current_team === 'A') {
                        document.getElementById('currentTeamInfo').style.borderColor = '#ff6b6b';
                        document.getElementById('currentTeamInfo').style.background = 'rgba(255, 107, 107, 0.2)';
                    } else {
                        document.getElementById('currentTeamInfo').style.borderColor = '#4d96ff';
                        document.getElementById('currentTeamInfo').style.background = 'rgba(77, 150, 255, 0.2)';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–≥—Ä–æ–∫–∞—Ö
                    document.getElementById('explainerName').textContent = data.explainer.username;
                    document.getElementById('guesserName').textContent = data.guesser.username;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    isExplainer = currentUser && (data.explainer.id === currentUser.id);
                    
                    // isCreator —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
                    const showControls = isExplainer;
                    document.getElementById('gameControls').style.display = showControls ? 'flex' : 'none';
                    document.getElementById('newWordBtn').style.display = showControls ? 'block' : 'none';
                    document.getElementById('nextTurnBtn').style.display = showControls ? 'block' : 'none';
                    document.getElementById('switchTeamBtn').style.display = isCreator ? 'block' : 'none';
                    
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –æ–±—ä—è—Å–Ω—è—é—â–∏–π, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                    if (!isExplainer) {
                        document.getElementById('wordContainer').innerHTML = 
                            `<div class="waiting">‚è≥ –ñ–¥–∏—Ç–µ, —Å–µ–π—á–∞—Å –æ–±—ä—è—Å–Ω—è–µ—Ç: <strong>${data.explainer.username}</strong></div>`;
                        document.getElementById('gameInstructions').style.display = 'none';
                    } else {
                        document.getElementById('gameInstructions').style.display = 'block';
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–π–º–µ—Ä
                    timeLeft = data.time_per_turn || 60;
                    updateTimerDisplay();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:', error);
            }
        }
        
        // –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ
        async function getNewWord() {
            if (!isExplainer) {
                showError('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥ –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è');
                return;
            }
            
            try {
                const response = await fetch('/api/get-word/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        room_id: roomId,
                        user_id: currentUser.id
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentWord = data.word;
                    document.getElementById('wordText').textContent = currentWord;
                    startTimer(); // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ–≤–∞
                    showSuccess('–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ! –û–±—ä—è—Å–Ω—è–π—Ç–µ...');
                } else {
                    showError(data.error || '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ–≤–æ');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            }
        }
        
        // –°–ª–æ–≤–æ —É–≥–∞–¥–∞–Ω–æ
        async function wordGuessed() {
            if (!isExplainer) {
                showError('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥');
                return;
            }
            
            if (!currentWord) {
                showError('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ —Å–ª–æ–≤–æ');
                return;
            }
            
            try {
                const response = await fetch('/api/word-guessed/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        room_id: roomId,
                        user_id: currentUser.id
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess('üéâ –û—Ç–ª–∏—á–Ω–æ! +1 –æ—á–∫–æ');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
                    document.getElementById('scoreA').textContent = data.score_a;
                    document.getElementById('scoreB').textContent = data.score_b;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–±–µ–¥—É
                    if (data.score_a >= gameState.target_score || data.score_b >= gameState.target_score) {
                        updateGameState();
                    } else {
                        // –ü–æ–ª—É—á–∞–µ–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ
                        getNewWord();
                    }
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–ª–æ–≤–æ
        async function skipWord() {
            if (!isExplainer) {
                showError('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥');
                return;
            }
            
            showSuccess('–°–ª–æ–≤–æ –ø—Ä–æ–ø—É—â–µ–Ω–æ');
            getNewWord();
        }
        
        // –°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥
        async function nextTurn() {
            if (!isExplainer) {
                showError('–°–µ–π—á–∞—Å –Ω–µ –≤–∞—à —Ö–æ–¥');
                return;
            }
            
            try {
                const response = await fetch('/api/next-turn/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        room_id: roomId,
                        user_id: currentUser.id
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showSuccess('–°–ª–µ–¥—É—é—â–∏–π —Ö–æ–¥!');
                    currentWord = null;
                    document.getElementById('wordText').textContent = '–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ"';
                    clearInterval(timerInterval);
                    updateGameState();
                } else {
                    showError(data.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Ö–æ–¥–∞');
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }
        
        // –°–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É
        async function switchTeam() {
            if (!isCreator) {
                showError('–¢–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—Ç–µ–ª—å –∫–æ–º–Ω–∞—Ç—ã –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É');
                return;
            }
            
            if (confirm('–°–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É? –°–µ–π—á–∞—Å –∏–≥—Ä–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ ' + gameState.current_team)) {
                try {
                    const response = await fetch('/api/switch-team/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            room_id: roomId,
                            user_id: currentUser.id
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showSuccess('–¢–µ–ø–µ—Ä—å –∏–≥—Ä–∞–µ—Ç –¥—Ä—É–≥–∞—è –∫–æ–º–∞–Ω–¥–∞!');
                        currentWord = null;
                        document.getElementById('wordText').textContent = '–ù–∞–∂–º–∏—Ç–µ "–ù–æ–≤–æ–µ —Å–ª–æ–≤–æ"';
                        clearInterval(timerInterval);
                        updateGameState();
                    }
                } catch (error) {
                    showError('–û—à–∏–±–∫–∞: ' + error.message);
                }
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
        function showWinner(winnerTeam) {
            document.getElementById('winnerTeam').textContent = winnerTeam === 'A' ? 'A üèÜ' : 'B üèÜ';
            document.getElementById('finalScore').textContent = 
                `${gameState.score_a} : ${gameState.score_b}`;
            document.getElementById('winnerMessage').style.display = 'block';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            document.querySelectorAll('.scores, .current-team, .players-info, .timer, .word-container, .controls, .btn, .instructions')
                .forEach(el => el.style.display = 'none');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—á–µ—Ç
            document.querySelector('.scores').style.display = 'flex';
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        updateGameState();
        setInterval(updateGameState, 3000);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—ä—è—Å–Ω—è—é—â–∏–º
            if (isExplainer) {
                showSuccess('–í—ã –æ–±—ä—è—Å–Ω—è—é—â–∏–π! –ü–æ–ª—É—á–∏—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ.');
            }
        });
    </script>
</body>

</html>